<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: files/objects.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: files/objects.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {parseJsonArrayBuffer, parseTextArrayBuffer, stringToArrayBuffer} from "../utils.js";

/**
 * An Object that contains metadata about a file.
 * @typedef {Object} FileNode
 * @property {string} id - A unique identifier for the file specific to its domain.
 * @property {boolean} name - The name of the file.
 * @property {boolean} url - The URL the file data can be accessed from. May be a Data URL.
 * @property {boolean} directory - Is the file a directory.
 * @property {boolean|null} icon - The url the file data can be accessed from.
 * @property {number|null} size - The size in bytes of the file.
 * @property {string} mimeType - The MIME type of the file.
 * @property {string} lastModified - An ISO 8601 date string of when the file was last modified.
 * @property {string} created - An ISO 8601 date string of when the file was created.
 * @property {boolean} hidden - Whether or not the file should be displayed in a user interface by default.
 */


export class FileObject {
  /**
   * An object representing a file or directory in a file system. Provides API for
   * performing operations on the file.
   * @param {AbstractFileStorage} fileStorage - The file system the file is on
   * @param {FileNode} fileNode - The FileNode object representing the file
   * @param {string} name - The name of this file.
   * @param {FileObject|null} parent - The parent directory for this file. Null if root directory.
   */
  constructor(fileStorage, fileNode, name, parent) {
    this._fileStorage = fileStorage;
    this._fileNode = fileNode;
    this._name = name;
    this._parent = parent;
    this._filePromiseCache = null;
  }

  // Getters
  get fileStorage() {
    return this._fileStorage;
  }

  get fileNode() {
    return this._fileNode;
  }

  get id() {
    return this._fileNode.id;
  }

  get name() {
    return this._name;
  }

  get path() {
    if (this.parent === null) {
      return [];
    }
    return this.parent.path.concat([this.name]);
  }

  get url() {
    return this._fileNode.url;
  }

  get directory() {
    return this._fileNode.directory;
  }

  get icon() {
    return this._fileNode.icon;
  }

  get mimeType() {
    return this._fileNode.mimeType;
  }

  get size(){
    return this._fileNode.size;
  }

  get lastModified() {
    return this._fileNode.lastModified;
  }

  get created() {
    return this._fileNode.created;
  }

  get parent() {
    return this._parent;
  }

  /**
   * Clear the file cache.
   */
  clearCache(){
    this._filePromiseCache = null;
    let parent = this.parent;
    if (parent){
      parent.clearCache();
    }
  }

  /**
   * Read the file.
   * @async
   * @param {Object} [params={}] - Read parameters.
   * @returns {Blob} - Blob (https://developer.mozilla.org/en-US/docs/Web/API/Blob)
   */
  async read(params) {
    if (this._filePromiseCache === null){
      this._filePromiseCache = this.fileStorage.readFileNode(this.id, params);
    }
    return await this._filePromiseCache;
  }

  /**
   * Read the file.
   * @async
   * @param {File|Blob} data - Raw data to write to the file.
   * @returns {ArrayBuffer} - Updated file data in an ArrayBuffer
   */
  async write(data) {
    this.clearCache();
    return await this.fileStorage.writeFileNode(this.id, data);
  }

  /**
   * Read the file as a string.
   * @async
   * @param {Object} [params={}] - Read parameters.
   * @returns {string} - File file data converted to a string.
   */
  async readText(params) {
    let buffer = await this.read(params);
    return parseTextArrayBuffer(buffer);
  }

  /**
   * Read the file as a json encoded string and convert to a Javascript Object.
   * @async
   * @param {Object} [params={}] - Read parameters.
   * @returns {Object|Array} - File file data converted to a Javascript Object.
   */
  async readJSON(params) {
    let file = await this.read(params);
    return parseJsonArrayBuffer(file);
  }

  /**
   * Change the name of the file.
   * @async
   * @param {string} newName - The new name for the file.
   */
  async rename(newName) {
    this.clearCache();
    await this.fileStorage.rename(this.id, newName);
    this._fileNode.name = newName;
  }

  /**
   * Delete the file from its storage location.
   * @async
   */
  async delete() {
    this.clearCache();
    return await this.fileStorage.delete(this.id);
  }

  /**
   * Search the file and all of its children recursively based on the query.
   * @async
   * @param {string} query - Words to be searched seperated by spaces.
   * @returns {FileObject[]} - A list of file objects.
   */
  async search(query) {
    let fileObjectList = [];
    let fileNodeList = await this.fileStorage.search(this.id, query);
    for (let node of fileNodeList){
      fileObjectList.push(new FileObject(this.fileStorage, node, node.name, this));
    }
    return fileObjectList;
  }

  toString(){
    return `/${this.path.join('/')}`;
  }
}

export class Link extends FileObject {
  /**
   * A FileObject that links to another file object. The file data is a json string with the
   * path of the file it links to.
   * @param {FileObject} fileObject - The file this links to.
   * @param {string} name - The name of the link
   * @param {FileObject|null} parent - The parent directory for this file. Null if root directory.
   */
  constructor(fileObject, name, parent){
    super(fileObject.fileStorage, fileObject.fileNode, name, parent);
    this._fileObject = fileObject;
  }


  get mimeType() {
    return 'inode/symlink';
  }

  async read(params) {
    return stringToArrayBuffer(JSON.stringify(this._fileObject.path));
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-utils.html">utils</a></li></ul><h3>Classes</h3><ul><li><a href="AbstractFileStorage.html">AbstractFileStorage</a></li><li><a href="BaseFileSystem.html">BaseFileSystem</a></li><li><a href="BreadCrumb.html">BreadCrumb</a></li><li><a href="Column.html">Column</a></li><li><a href="DialogBrowser_DialogBrowser.html">DialogBrowser</a></li><li><a href="Element.html">Element</a></li><li><a href="FileAPIFileStorage.html">FileAPIFileStorage</a></li><li><a href="FileBrowser_FileBrowser.html">FileBrowser</a></li><li><a href="FileObject_FileObject.html">FileObject</a></li><li><a href="FileSystem.html">FileSystem</a></li><li><a href="Link_Link.html">Link</a></li><li><a href="LocalStorageFileStorage_LocalStorageFileStorage.html">LocalStorageFileStorage</a></li><li><a href="MemoryFileStorage_MemoryFileStorage.html">MemoryFileStorage</a></li><li><a href="PhotoshelterStorage_PhotoshelterStorage.html">PhotoshelterStorage</a></li><li><a href="Row.html">Row</a></li><li><a href="Table.html">Table</a></li></ul><h3>Mixins</h3><ul><li><a href="CacheMixin.html">CacheMixin</a></li><li><a href="DraggableMixin.html">DraggableMixin</a></li><li><a href="DroppableMixin.html">DroppableMixin</a></li><li><a href="ExecutableMixin.html">ExecutableMixin</a></li><li><a href="HiddenFileAPIMixin.html">HiddenFileAPIMixin</a></li><li><a href="HiddenReferenceLinkMixin.html">HiddenReferenceLinkMixin</a></li><li><a href="MountStorageMixin.html">MountStorageMixin</a></li><li><a href="StateMixin.html">StateMixin</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-DeveloperTutorial.html">Developers</a></li><li><a href="tutorial-UserInterfaceTutorial.html">User Interface</a></li></ul><h3>Global</h3><ul><li><a href="global.html#parseConfigFile">parseConfigFile</a></li><li><a href="global.html#updateConfigFile">updateConfigFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
