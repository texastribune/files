var systemx=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(1);class o extends Error{constructor(t){super(t),this.name=this.constructor.name}}e.FileNotFoundError=o,e.isDirectory=function(t){return t.directory};class s{constructor(){this._onChangeListeners=[]}onChange(){for(let t of this._onChangeListeners)t(this)}addOnChangeListener(t){this._onChangeListeners.push(t)}get directory(){return!1}readText(t){return r(this,void 0,void 0,function*(){let e=yield this.read(t);return i.parseTextArrayBuffer(e)})}readJSON(t){return r(this,void 0,void 0,function*(){let e=yield this.read(t);return i.parseJsonArrayBuffer(e)})}copy(t){return r(this,void 0,void 0,function*(){yield t.write(yield this.read())})}move(t){return r(this,void 0,void 0,function*(){yield this.copy(t),yield this.delete()})}toString(){return this.name}}e.BasicFile=s;class a extends s{static get mimeType(){return"application/json"}get mimeType(){return a.mimeType}get size(){return 0}get url(){return null}read(t){return r(this,void 0,void 0,function*(){let t=[],e=yield this.getChildren();for(let n of e)t.push({id:n.id,name:n.name,directory:n.directory,url:n.url,icon:n.icon,size:n.size,mimeType:n.mimeType,lastModified:n.lastModified.toISOString(),created:n.created.toISOString(),extra:n.extra});let n=JSON.stringify(t);return i.stringToArrayBuffer(n)})}write(t){return r(this,void 0,void 0,function*(){throw new Error("Cannot write to a directory.")})}getFile(t){return r(this,void 0,void 0,function*(){if(0===t.length)return this;let e,n,r=t[t.length-1],i=t.slice(0,t.length-1),s=yield this.getFile(i);if(!(s instanceof a))throw new o(`File ${r} not found.`);for(e=yield s.getChildren();void 0===n;){let t=e.pop();if(void 0===t)throw new o(`File ${r} not found.`);t.name===r&&(n=t)}return n})}}e.Directory=a},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});let n=["KB","MB","GB","TB"];function r(e){if(void 0!==t)return t.from(e).toString();if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(new Uint8Array(e));{let t=new Uint8Array(e);return String.fromCharCode.apply(null,t)}}e.convertBytesToReadable=function(t){let e=null,r=n.length;for(;!e&&r>0;){let i=t/Math.pow(10,3*r),o=i>10?0:1;if(i>1||0===r){let t=n[r-1];e=`${i.toFixed(o)} ${t}`}r--}return e||`${t} bytes`},e.compareStrings=function(t,e){return t.localeCompare(e)},e.compareNumbers=function(t,e){return t-e},e.compareDateStrings=function(t,e){return new Date(t).getTime()-new Date(e).getTime()},e.parseTextArrayBuffer=r,e.parseJsonArrayBuffer=function(t){let e=r(t);return JSON.parse(e)},e.arrayBufferToDataUrl=function(t,e){let n="",r=new Uint8Array(t);for(let t of r)n+=String.fromCharCode(t);return`data:${e};base64,${btoa(n)}`},e.fileToArrayBuffer=function(t){return new Promise((e,n)=>{let r=new FileReader;r.onload=(()=>{let i=r.result;i instanceof ArrayBuffer?e(i):n("Could not read file "+t)}),r.onerror=(()=>{n(r.error)}),r.readAsArrayBuffer(t)})},e.stringToArrayBuffer=function(t){return Uint8Array.from([...t].map(t=>t.charCodeAt(0))).buffer},e.copyArrayBuffer=function(t){let e=new ArrayBuffer(t.byteLength);return new Uint8Array(e).set(new Uint8Array(t)),e},e.getOpt=function(...t){let e=0,n={};for(;e<t.length;){if(t[e].startsWith("-")){let r=t.splice(e,2);n[r[0].substr(1)]=r[1]||""}e++}return[t,n]}}).call(this,n(10).Buffer)},function(t,e,n){"use strict";n.r(e),n.d(e,"CustomElement",function(){return r});class r extends HTMLElement{constructor(){super(),this.connected=!1,null===this.shadowRoot&&this.attachShadow({mode:"open"})}static get observedAttributes(){return[]}get css(){return null}get template(){return null}connectedCallback(){this.connected=!0,this.refresh()}disconnectedCallback(){this.connected=!1}attributeChangedCallback(t,e,n){this.connected&&this.refresh()}removeShadowChildren(){if(this.shadowRoot)for(;this.shadowRoot.firstChild;)this.shadowRoot.removeChild(this.shadowRoot.firstChild)}removeChildren(t){if(void 0!==t){let e=Array.from(this.children);for(let n of e)n instanceof t&&this.removeChild(n)}else for(;this.firstChild;)this.removeChild(this.firstChild)}appendShadowChild(t){this.shadowRoot&&this.shadowRoot.appendChild(t)}appendShadowChildren(t){if(this.shadowRoot){let e=document.createDocumentFragment();for(let n of t)e.appendChild(n);this.shadowRoot.appendChild(e)}}appendChildren(t){let e=document.createDocumentFragment();for(let n of t)e.appendChild(n);this.appendChild(e)}flatChildren(t){return function e(n){let r=[];for(let i of n.children)(void 0===t||i instanceof t)&&r.push(i),r=r.concat(e(i));return r}(this)}refresh(){this.removeShadowChildren();let t={};for(let e of this.constructor.observedAttributes)t[e]=this.getAttribute(e);this.updateAttributes(t),this.shadowRoot&&this.render(this.shadowRoot)}render(t){let e=this.css;if(e){let n=document.createElement("style");n.type="text/css",n.innerHTML=e.toString(),t.appendChild(n)}let n=this.template;if(n){if(!(n instanceof HTMLTemplateElement)){let t=document.createElement("template");t.innerHTML=n.toString(),n=t}let e=document.importNode(n.content,!0);t.appendChild(e)}}}},function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return s});var r=n(2);class i extends r.CustomElement{constructor(){super(),this._position={x:0,y:0},this._velocity={x:0,y:0},this.motionTimeout=null,this.lastPositionUpdateTime=null,this.frictionCoef=100,this.timeStep=.01}updateAttributes(t){}connectedCallback(){super.connectedCallback(),this.style.position="absolute",this.lastPositionUpdateTime=null,this.position={x:0,y:0}}get position(){return Object.assign({},this._position)}set position(t){let e=this._position;this._position={x:t.x||0,y:t.y||0},this.style.left=`${Math.round(this._position.x).toString()}px`,this.style.top=`${Math.round(this._position.y).toString()}px`;let n=(new Date).getTime();if(null!==this.lastPositionUpdateTime){let t=(n-this.lastPositionUpdateTime)/1e3;this.velocity={x:(this._position.x-e.x)/t,y:(this._position.y-e.y)/t}}this.lastPositionUpdateTime=n}get frictionForce(){let t=this.velocity,e=Math.sign(t.x)||0,n=Math.sign(t.y)||0;return{x:-1*e*this.frictionCoef,y:-1*n*this.frictionCoef}}get velocity(){return this._velocity||{x:0,y:0}}set velocity(t){this.motionTimeout&&clearTimeout(this.motionTimeout),this.motionTimeout=null;let e=t.x,n=t.y;if(this._velocity={x:e,y:n},e>0||n>0)if(this.speed<10)this.velocity={x:0,y:0};else{const t=this.timeStep;this.motionTimeout=window.setTimeout(()=>{let r=this.position;this.position={x:r.x+e*t,y:r.y+n*t};let i=this.frictionForce,o=e+i.x*t,s=n+i.y*t;Math.sign(o)!==Math.sign(e)&&(o=0),Math.sign(s)!==Math.sign(n)&&(s=0),this.velocity={x:o,y:s}},1e3*t)}}get speed(){let t=this.velocity;return Math.sqrt(t.x*t.x+t.y*t.y)}center(){let t=this.getBoundingClientRect(),e=window.innerWidth/2-t.width/2,n=window.innerHeight/2-t.height/2;this.position={x:e,y:n},this.velocity={x:0,y:0}}}class o extends i{constructor(){super(),this.startPosition={x:0,y:0},this.mouseStartPosition={x:0,y:0},this.includeChildren=!1,this.noPropagate=!1,this.onmousedown=(t=>{this.noPropagate&&t.stopImmediatePropagation(),(t.target===this||this.includeChildren)&&(t.preventDefault(),this.startPosition=this.position,this.mouseStartPosition={x:t.clientX,y:t.clientY},this.startDrag())})}startDrag(){document.onmousemove=(t=>{t.preventDefault(),this.noPropagate&&t.stopImmediatePropagation();let e=t.clientX-this.mouseStartPosition.x,n=t.clientY-this.mouseStartPosition.y;this.position={x:this.startPosition.x+e,y:this.startPosition.y+n},this.velocity={x:0,y:0}}),document.onmouseup=this.stopDrag.bind(this)}stopDrag(t){this.noPropagate&&t.stopImmediatePropagation(),t.preventDefault(),document.onmousemove=null,document.onmouseup=null}}class s extends i{constructor(){super(),this.touchStartPosition={},this.scrollSpeed=s.defaultScrollSpeed,this.onwheel=(t=>{let e=this.position;e.y-=t.deltaY*this.scrollSpeed,this.position=e}),this.ontouchstart=(t=>{for(let e of t.targetTouches)this.touchStartPosition[e.identifier]={coords:{x:e.clientX,y:e.clientY},elementPosition:this.position}}),this.ontouchmove=(t=>{for(let e of t.targetTouches){let t=this.touchStartPosition[e.identifier];if(t){let n=e.clientX-t.coords.x,r=e.clientY-t.coords.y;this.position={x:t.elementPosition.x+n,y:t.elementPosition.y+r}}}}),this.ontouchend=(t=>{for(let e of t.targetTouches)delete this.touchStartPosition[e.identifier]})}static get observedAttributes(){return["scroll-speed"]}updateAttributes(t){let e=t["scroll-speed"];this.scrollSpeed=null===e?s.defaultScrollSpeed:Number.parseFloat(e)}}s.defaultScrollSpeed=1},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n(0));let s=0;class a extends o.BasicFile{constructor(t,e,n,r){super(),this.created=new Date,this.icon=null,this.url=null,this.extra={},this.parent=t,this.name=e,this.mimeType=n||"application/octet-stream",this.fileData=r||new ArrayBuffer(0),this.lastModified=new Date,s++,this.id=s.toString()}get size(){return this.fileData.byteLength}read(t){return r(this,void 0,void 0,function*(){return this.fileData})}write(t){return r(this,void 0,void 0,function*(){return this.fileData=t,this.lastModified=new Date,t})}delete(){return r(this,void 0,void 0,function*(){this.parent.removeChild(this)})}rename(t){return r(this,void 0,void 0,function*(){this.name=t,this.lastModified=new Date})}}e.MemoryFile=a;class l extends o.Directory{constructor(t,e){super(),this.created=new Date,this.icon=null,this.extra={},this._children=[],this.parent=t,this.name=e,s++,this.id=s.toString()}get lastModified(){return 0===Object.values(this._children).length?this.created:new Date(Math.max.apply(null,Object.values(this._children).map(function(t){return new Date(t.lastModified).getTime()})))}delete(){return r(this,void 0,void 0,function*(){null!==this.parent&&this.parent.removeChild(this)})}rename(t){return r(this,void 0,void 0,function*(){this.name=t})}getChildren(){return r(this,void 0,void 0,function*(){return this._children.slice()})}search(t){return r(this,void 0,void 0,function*(){let e=[];for(let n of this._children)if(name===t&&e.push(n),n instanceof o.Directory){let r=yield n.search(t);e=e.concat(r)}return e})}addFile(t,e,n){return r(this,void 0,void 0,function*(){let r=new a(this,e,n,t);return this.addChild(r),r})}addDirectory(t){return r(this,void 0,void 0,function*(){let e=new l(this,t);return this.addChild(e),e})}addChild(t){this._children.push(t)}removeChild(t){this._children=this._children.filter(e=>e!==t)}}e.MemoryDirectory=l},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0);let o=0,s=[];e.ProcessFile=class extends i.BasicFile{constructor(){super(),this._created=new Date,this._lastModified=new Date,o++,this._id=o,s.push(this)}get id(){return this._id.toString()}get url(){return null}get icon(){return null}get size(){return 0}get mimeType(){return"text/plain"}get created(){return this._created}get lastModified(){return this._lastModified}delete(){return r(this,void 0,void 0,function*(){s=s.filter(t=>t!==this)})}};e.ProcessDirectory=class extends i.Directory{constructor(){super(...arguments),this._created=new Date,this._lastModified=new Date}get id(){return"proc"}get name(){return"proc"}get url(){return null}get icon(){return null}get created(){return this._created}get lastModified(){return this._lastModified}getChildren(){return r(this,void 0,void 0,function*(){return s.slice()})}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Dialog",function(){return i}),n.d(e,"ConfirmDialog",function(){return o});var r=n(3);class i extends r.a{constructor(){super(),this.deleteButtonClass="delete",this.expandButtonClass="expand",this.nameClass="name",this.headerClass="header",this.containerClass="container",this.noPropagate=!0,this.onShow=null,this.onClose=null,this.onRemove=null,this.nameElement=document.createElement("span"),this.nameElement.className=this.nameClass,this.headerElement=document.createElement("div"),this.headerElement.className=this.headerClass,this.containerElement=document.createElement("div"),this.containerElement.className=this.containerClass;let t=document.createElement("button");t.type="button",t.className=this.expandButtonClass,t.onmousedown=(t=>{t.stopPropagation(),t.preventDefault()}),t.onclick=(t=>{t.stopPropagation(),t.preventDefault(),this.expanded=!0});let e=document.createElement("button");e.type="button",e.className=this.deleteButtonClass,e.onmousedown=(t=>{t.stopPropagation(),t.preventDefault()}),e.onclick=(t=>{t.stopPropagation(),t.preventDefault(),this.visible=!1}),this.headerElement.appendChild(this.nameElement),this.headerElement.appendChild(e),this.headerElement.appendChild(t);let n=document.createElement("slot");this.containerElement.appendChild(n),this.documentClickListener=(t=>{this.closeOnOutsideClick(t)})}static get observedAttributes(){return["name","visible","expanded"]}get css(){return`     \n      :host {\n        --dialog-font: 'Open Sans', sans-serif;\n        --dialog-background: #ecf2f6;\n        --dialog-shadow: 2px 2px 0 0 #444;\n        --dialog-header-height: 28px;\n        --dialog-header-text-color: black;\n        --dialog-header-background-color: #c0d5e8;\n        --dialog-item-text-color: #5c6873;\n        --button-color: white;\n        --button-hover-color: #999;\n        --button-height: 30px;\n        --button-min-width: 50px;\n        --delete-button: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gMUEDkZeUosOwAAAtJJREFUWMPNmL9PFEEUxz+7IfzQkHCGQlBC7uzuYiWUlIaWno20a71/x9ROCxl7WmJ5JViZozwERCyIZ0ICQsFa+Nasm52ZvRXO+yab7CVv5r47853ve28CKiCKE4xW2fsrYA1YBzrAUiH8FOgBe0DXaPWxOIcLQRUiUZw8AjaA99TDW2DbaHXtIxZUIPMG2OZ+sGW02nGRCjxk9oEV7hcHRqtVGykboQZwDkzxMLgBFoxWAyehKE4AGsB3RoMF4Ft+pcKSk3TO6PBZpPE3oYJmpkZIaCqKk/08qSC3Qq7TlEpsB/gALFb8w6/Aa/Gl1HGqt4xWOwCBMJsBrhxkboG20aofxUkAHAHLHjLHQNNolUZx0gIOgUkHqcfAVSi62fKYZxvo5wi2gIFjzEBiUvndlzlcRrxhtPodEMVJ6gjsGK0OS6xhBvghX53HLTBntLouGdOW7SuF0SoIJDcdeHTwHEiLRiakzsQqspV5ViQjsgiALx79rYSSKF1YFM2EJV90DcyLXo6B+bKVkbFHFQ7DWihZ24dl4EJWpIg74KU8d5atvahwCADWgyhOTkpKCBus+rCkIJvObDgNPIK2naB54M6WsUUzoaxMY5jJwxru2pBjPOuImZWYxrCT1yH0oKhDKDO9S0fMZQXzLHfhcRP1hDjnUsWVsZlepqfLvNClhp4rmKcLvVC6Ax98pvdJHp95+rAXAt0KJUSzgun5zLMpc7nQHbvkOiHvm46eqxfFyQugn6vsQtFFmVgngbMoTv6Yp4xpuchI70YowbuOwFSKq1auPvKZXmaeWf2TFWiundiO4mT8Sth8kb/jqIuyiXpDkMlKl56nSz7IutlikZ91Hj9H2HncGK2m811sWaP4dIS92RNgkDfTsWulbcl1YLSa9tTa/3LZMG1LvKHFoDJNrXpapDrXMatDX8eUCH1GiL2rSWQT2DVaXdW+sPpfV3q/AM0PYtQhZQVnAAAAAElFTkSuQmCC);\n        --expand-button: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gYHEhUdzt4g4wAAAlJJREFUWMPtmLFr20AUxn+6Oq7imoQUCs2QvyCDh9TQJVshayBbY+rVhUIH/xnlhnbJrTGXbKVdM3XwEmgyZAhkLHhIoVDToXbT0KbLU1CPk6zIqqOhHwgZcXr+9O5J7/teQAa0Ol2s0dHvNWAd2ABWgRVn+QA4BQ6AvjX62I2RhiALkVanWwM2gT3y4Tmwa40eTyIWZCDzDNilGLSt0b00UsEEMh+BRxSLI2t0M4lUEqEl4By4y7/BBbBsjR6mEmp1ugBLwFdmg2XgczxTyvMmnTM7fJLS+DtDE2rmDPgAhMDClAQWgQbwIKmmgliGfG/TGbAl5wC4MyWhqsR75ZBqW6N7AIGkax4YeQLsAC+A3wVuUx14Bzxxrt8DRkrqpp1wc+gU/pw85U2PuViMn8A3z39tWqOpxDLhw4Js0y+gArwEHufIyiHwGrhMWbMH7FekN2WBEjJbObfqTYaeuaakUZYF60q6dlmwoURClAWryqNnbhMripLhP6EshAYl4jNQIsjLglMl7qAsOFBAv0SE+iryTWWANfo46vbbGTzXlXTtPDiU+yd5t2uBVgO+exa9BZ6Khon0UJCD0FVMelSBfY9qqAHjigi0UavTbXsk7KIEiAhdFrAzVYnrGsjx9YdRBHYPOHIWNuRJ6jmVonvUJV7DEfm9yHkEHrf6wzGIX4CTBNk5reu4sEaHcRfrM4oPZ+jN7gPDuFEsnZVOaq5Da3Toqamihg0hMMzc7SN7a41uplikvOOY5o3HMZ5CnxdiOzmJbAPvrdGj3AOr2xrp/QFWN+Jth0cnawAAAABJRU5ErkJggg==);\n      \n        display: none;\n        background: var(--dialog-background);\n        box-shadow: var(--dialog-shadow);\n        z-index: 10;\n        font-family: var(--dialog-font);\n        font-weight: bold;\n        border: 1px solid black;\n      }\n      \n      :host([visible]) {\n        display: block;\n      }\n    \n      :host([expanded]) {\n        width: 100%;\n        height: 100%;\n      }\n      \n      .${this.headerClass} {\n        display: flex;\n        box-sizing: border-box;\n        height: var(--dialog-header-height);\n        padding-left: 4px;\n        background-color: var(--dialog-header-background-color);\n        color: var(--dialog-header-text-color);\n        white-space: nowrap;\n        cursor: move;\n      }\n      \n      .${this.nameClass} {\n        flex: 1;\n        line-height: var(--dialog-header-height);\n        margin-left: 4px;\n        margin-right: 4px;\n        font-size: 14px;\n      }\n      \n      .${this.headerClass} > button {\n        border: none;\n        background-color: inherit;\n        padding: unset;\n        width: var(--dialog-header-height);\n        height: var(--dialog-header-height);\n      }\n      \n      button {\n        display: inline-block;\n        float: right;\n        width: 18px;\n        height: 18px;\n        cursor: pointer;\n      }\n      \n      .${this.expandButtonClass}::after {\n        display: inline-block;\n        width: 100%;\n        height: 100%;\n        background-size: 18px 18px;\n        background-image: var(--expand-button);\n        background-repeat: no-repeat;\n        background-position: center;\n        content: "";\n      }\n      \n      .${this.deleteButtonClass}::after {\n        display: inline-block;\n        width: 100%;\n        height: 100%;\n        background-size: 18px 18px;\n        background-image: var(--delete-button);\n        background-repeat: no-repeat;\n        background-position: center;\n        content: "";\n      }\n    `}get name(){return this.nameElement.innerText}set name(t){this.nameElement.innerText=t}get visible(){return!(null===this.getAttribute("visible"))}set visible(t){if(t!==this.visible)if(t){this.setAttribute("visible","true");let t=new Event(i.EVENT_OPENED);this.dispatchEvent(t)}else{this.removeAttribute("visible");let t=new Event(i.EVENT_CLOSED);this.dispatchEvent(t)}}get expanded(){return!(null===this.getAttribute("expanded"))}set expanded(t){t!==this.expanded&&(t?(this.setAttribute("expanded","true"),this.position={x:0,y:0}):this.removeAttribute("expanded"))}updateAttributes(t){this.visible=!(null===t.visible),this.expanded=!(null===t.expanded),null===t.name?this.name="":this.name=t.name}connectedCallback(){super.connectedCallback(),this.style.position="fixed",document.addEventListener("click",this.documentClickListener)}disconnectedCallback(){document.removeEventListener("click",this.documentClickListener)}render(t){super.render(t),t.appendChild(this.headerElement),t.appendChild(this.containerElement)}remove(){this.onRemove&&this.onRemove(this),this.parentElement&&this.parentElement.removeChild(this),document.removeEventListener("click",this.documentClickListener)}closeOnOutsideClick(t){if(!t.defaultPrevented){let e=new Set,n=t.target;for(;n;)e.add(n),n=n.parentElement;let r=e.has(this),o=!1;for(let t of this.flatChildren(i))e.has(t)&&(o=!0);r||o||(this.visible=!1)}}}i.EVENT_OPENED="opened",i.EVENT_CLOSED="closed";class o extends i{constructor(){super(),this._confirmButton=document.createElement("button")}render(t){super.render(t),this._confirmButton.innerText="Yes",this._confirmButton.onclick=this.onConfirmed.bind(this),this._confirmButton.className="button",t.appendChild(this._confirmButton)}set confirmationText(t){this._confirmButton.innerText=t}set disabled(t){this._confirmButton.disabled=Boolean(t)}onConfirmed(t){t.preventDefault(),this.visible=!1;let e=new Event(o.EVENT_CONFIRMED);this.dispatchEvent(e)}}o.EVENT_CONFIRMED="confirmed",customElements.define("base-dialog",i),customElements.define("confirm-dialog",o)},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(5),o=n(1),s=Object.getPrototypeOf(function(){return r(this,void 0,void 0,function*(){})}).constructor,a='\n    // wrap onmessage setup in function so that variables created (id, calls, etc.)\n    // aren\'t in worker script scope.\n    onmessage = function () {\n        const AsyncFunction = Object.getPrototypeOf(async function(){}).constructor;\n    \n        let id = 0;\n        const calls = {};\n    \n        const system = new Proxy({}, {\n            get: function (obj, sysCallName) {\n                // Make a system call "prop"\n                return (...args) => {\n                    return new Promise((resolve, reject) => {\n                        id ++;\n                        calls[id] = resolve;\n                        postMessage([id, sysCallName].concat(args));\n                    });\n                }\n            }\n        });\n        \n        function initialize(e) {\n            let func = new AsyncFunction(\'system\', e.data);\n            func.bind(this)(system)\n                .then(() => {\n                    return system.exit("");\n                }).catch((error) => {\n                system.error(error.toString());\n                console.log(error);\n            });\n            messageHandler = handleCallReturn;\n        }\n        \n        function handleCallReturn(e) {\n            let id = e.data[0];\n            let data = e.data[1];\n            let sysCall = calls[id];\n            if (sysCall){\n                delete calls[id];\n                sysCall(data);\n            }\n        }\n        \n        let messageHandler = initialize;\n    \n    \n        return messageHandler;\n    }();\n';let l=0;class c extends i.ProcessFile{constructor(t,e,n,r,i){super(),this.fileDescriptors={},this.parentProcess=t,this.workingDirectory=e,this.executablePath=n,this.executableName=n[n.length-1],this.stdin=this,this.stdout=r,this.stderr=i,this.worker=new Worker("data:application/javascript,"+encodeURIComponent(a)),this.worker.onmessage=(t=>{let e=t.data[0],n=t.data[1],r=t.data.slice(2);console.log("WORKER CALL",n);let i=this.systemCalls[n];i?i(...r).then(t=>{this.worker.postMessage([e,t])}).catch(t=>{let e=o.stringToArrayBuffer(`System error: ${t}`);return this.onExit(),this.stderr.write(e)}):console.log(`Invalid operation ${n}`)}),this.workingDirectory.getFile(this.executablePath).then(t=>t.readText()).then(t=>this.worker.postMessage(t)).catch(t=>{let e=o.stringToArrayBuffer(`File ${this.executableName} could not be executed: ${t}`);return this.onExit(),this.stderr.write(e)})}get name(){return this.executableName}fork(){return new c(this,this.workingDirectory,[this.executableName],this.stdout,this.stderr)}get systemCalls(){let t=t=>{let e=this.fileDescriptors[t];if(void 0===e)throw new Error("File is not open.");return e};return{import:(t,e)=>r(this,void 0,void 0,function*(){let n=yield(yield this.workingDirectory.getFile(t)).readText();try{return yield new s(`${n};return ${e};`).bind(this)()}catch(e){throw new Error(`Error importing file at ${t.join("/")}: ${e}`)}}),open:t=>r(this,void 0,void 0,function*(){let e=yield this.workingDirectory.getFile(t);return l++,this.fileDescriptors[l]=e,l}),close:t=>r(this,void 0,void 0,function*(){delete this.fileDescriptors[t]}),read:e=>r(this,void 0,void 0,function*(){return yield t(e).read()}),write:(e,n)=>r(this,void 0,void 0,function*(){return yield t(e).write(n)}),fork:()=>r(this,void 0,void 0,function*(){let t=new c(this,this.workingDirectory,[this.executableName],this.stdout,this.stderr);return Number.parseInt(t.id)}),exec:(t,...e)=>r(this,void 0,void 0,function*(){let e=new c(this,this.workingDirectory,t,this.stdout,this.stderr);return Number.parseInt(e.id)}),exit:t=>r(this,void 0,void 0,function*(){let e=o.stringToArrayBuffer(t);yield this.stdout.write(e),this.onExit()}),error:t=>r(this,void 0,void 0,function*(){let e=o.stringToArrayBuffer(`The process ${this.name} returned an error: ${t}`);yield this.stderr.write(e),this.onExit()})}}execPath(t,...e){return r(this,void 0,void 0,function*(){return new c(this,this.workingDirectory,t,this.stdout,this.stderr).id})}onExit(){this.worker.terminate(),this.delete()}}e.Process=c},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const o=n(15),s=n(16),a=n(17),l=i(n(0)),c=[new o.ConsoleFile,new s.NullFile];e.DeviceDirectory=class extends l.Directory{constructor(){super(),this.created=new Date,this.lastModified=new Date,this.extra={},this.extraChildren=[],this.extraChildren=[];for(let t of document.querySelectorAll(".device"))this.extraChildren.push(new a.DomElementDevice(t))}get name(){return"dev"}get id(){return"dev"}get icon(){return null}getChildren(){return r(this,void 0,void 0,function*(){return c.slice().concat(this.extraChildren)})}addDirectory(t){return r(this,void 0,void 0,function*(){throw new Error("can't add directory to device directory")})}addFile(t,e,n){return r(this,void 0,void 0,function*(){throw new Error("can't add file to device directory")})}delete(){return r(this,void 0,void 0,function*(){throw new Error("can't delete device directory")})}rename(t){return r(this,void 0,void 0,function*(){throw new Error("can't rename device directory")})}search(t){return r(this,void 0,void 0,function*(){return[]})}}},function(t,e,n){"use strict";n.r(e),n.d(e,"fs",function(){return c}),n.d(e,"createFS",function(){return h}),n.d(e,"start",function(){return u});var r=n(4),i=n(7),o=n(1),s=n(5),a=n(8),l=(n(18),n(23));const c=new l.VirtualDirectory(new r.MemoryDirectory(null,"root"));async function h(){let t=new l.VirtualDirectory(new r.MemoryDirectory(null,"root"));return(await t.addDirectory("dev")).mount(new a.DeviceDirectory),(await t.addDirectory("proc")).mount(new s.ProcessDirectory),t}async function u(){await c.addFile(Object(o.stringToArrayBuffer)('let fd = await system.open(["proc"]); let file = await system.readText(fd);await system.exec(["alert.js"]);console.log("FILE", file);await system.exit("DONE");'),"init.js"),await c.addFile(Object(o.stringToArrayBuffer)('console.log("ALERT");let fd = await system.open(["dev"]); let file = await system.readText(fd);console.log("FILE", file);'),"alert.js");let t=await c.getFile(["dev","console"]);new i.Process(null,c,["init.js"],t,t)}},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(12),i=n(13),o=n(14);function s(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=l.prototype:(null===t&&(t=new l(e)),t.length=e),t}function l(t,e,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return u(this,t)}return c(this,t,e,n)}function c(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);l.TYPED_ARRAY_SUPPORT?(t=e).__proto__=l.prototype:t=d(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(e,n),i=(t=a(t,r)).write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function(t,e){if(l.isBuffer(e)){var n=0|f(e.length);return 0===(t=a(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?a(t,0):d(t,e);if("Buffer"===e.type&&o(e.data))return d(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function u(t,e){if(h(e),t=a(t,e<0?0:0|f(e)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function d(t,e){var n=e.length<0?0:0|f(e.length);t=a(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function f(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function p(t,e){if(l.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Y(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(t).length;default:if(r)return Y(t).length;e=(""+e).toLowerCase(),r=!0}}function g(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function m(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=l.from(e,r)),l.isBuffer(e))return 0===e.length?-1:y(t,e,n,r,i);if("number"==typeof e)return e&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):y(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(t,e,n,r,i){var o,s=1,a=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,l/=2,n/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var h=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===l)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){for(var u=!0,d=0;d<l;d++)if(c(t,o+d)!==c(e,d)){u=!1;break}if(u)return o}return-1}function v(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function w(t,e,n,r){return H(Y(e,t.length-n),t,n,r)}function b(t,e,n,r){return H(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function C(t,e,n,r){return b(t,e,n,r)}function x(t,e,n,r){return H(j(e),t,n,r)}function E(t,e,n,r){return H(function(t,e){for(var n,r,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function A(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function D(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,s,a,l,c=t[i],h=null,u=c>239?4:c>223?3:c>191?2:1;if(i+u<=n)switch(u){case 1:c<128&&(h=c);break;case 2:128==(192&(o=t[i+1]))&&(l=(31&c)<<6|63&o)>127&&(h=l);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(h=l)}null===h?(h=65533,u=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=u}return function(t){var e=t.length;if(e<=T)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=T));return n}(r)}e.Buffer=l,e.SlowBuffer=function(t){+t!=t&&(t=0);return l.alloc(+t)},e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),l.poolSize=8192,l._augment=function(t){return t.__proto__=l.prototype,t},l.from=function(t,e,n){return c(null,t,e,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(t,e,n){return function(t,e,n,r){return h(e),e<=0?a(t,e):void 0!==n?"string"==typeof r?a(t,e).fill(n,r):a(t,e).fill(n):a(t,e)}(null,t,e,n)},l.allocUnsafe=function(t){return u(null,t)},l.allocUnsafeSlow=function(t){return u(null,t)},l.isBuffer=function(t){return!(null==t||!t._isBuffer)},l.compare=function(t,e){if(!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=l.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var s=t[n];if(!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},l.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?D(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return S(this,e,n);case"utf8":case"utf-8":return D(this,e,n);case"ascii":return _(this,e,n);case"latin1":case"binary":return M(this,e,n);case"base64":return A(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},l.prototype.compare=function(t,e,n,r,i){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var o=i-r,s=n-e,a=Math.min(o,s),c=this.slice(r,i),h=t.slice(e,n),u=0;u<a;++u)if(c[u]!==h[u]){o=c[u],s=h[u];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},l.prototype.indexOf=function(t,e,n){return m(this,t,e,n,!0)},l.prototype.lastIndexOf=function(t,e,n){return m(this,t,e,n,!1)},l.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return v(this,t,e,n);case"utf8":case"utf-8":return w(this,t,e,n);case"ascii":return b(this,t,e,n);case"latin1":case"binary":return C(this,t,e,n);case"base64":return x(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function _(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function M(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function S(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=U(t[o]);return i}function P(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function B(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function O(t,e,n,r,i,o){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function L(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function R(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function k(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(t,e,n,r,o){return o||k(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function I(t,e,n,r,o){return o||k(t,0,n,8),i.write(t,e,n,r,52,8),n+8}l.prototype.slice=function(t,e){var n,r=this.length;if(t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=l.prototype;else{var i=e-t;n=new l(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},l.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},l.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},l.prototype.readUInt8=function(t,e){return e||B(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return e||B(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return e||B(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},l.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},l.prototype.readInt8=function(t,e){return e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){e||B(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(t,e){e||B(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(t,e){return e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return e||B(t,4,this.length),i.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return e||B(t,4,this.length),i.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return e||B(t,8,this.length),i.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return e||B(t,8,this.length),i.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||O(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},l.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||O(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},l.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,1,255,0),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},l.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},l.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):R(this,t,e,!0),e+4},l.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},l.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);O(this,t,e,n,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},l.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);O(this,t,e,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},l.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,1,127,-128),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},l.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},l.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):R(this,t,e,!0),e+4},l.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||O(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},l.prototype.writeFloatLE=function(t,e,n){return F(this,t,e,!0,n)},l.prototype.writeFloatBE=function(t,e,n){return F(this,t,e,!1,n)},l.prototype.writeDoubleLE=function(t,e,n){return I(this,t,e,!0,n)},l.prototype.writeDoubleBE=function(t,e,n){return I(this,t,e,!1,n)},l.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},l.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=l.isBuffer(t)?t:Y(new l(t,r).toString()),a=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%a]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function U(t){return t<16?"0"+t.toString(16):t.toString(16)}function Y(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],s=0;s<r;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function j(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(N,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function H(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(11))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";e.byteLength=function(t){var e=c(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){for(var e,n=c(t),r=n[0],s=n[1],a=new o(function(t,e,n){return 3*(e+n)/4-n}(0,r,s)),l=0,h=s>0?r-4:r,u=0;u<h;u+=4)e=i[t.charCodeAt(u)]<<18|i[t.charCodeAt(u+1)]<<12|i[t.charCodeAt(u+2)]<<6|i[t.charCodeAt(u+3)],a[l++]=e>>16&255,a[l++]=e>>8&255,a[l++]=255&e;2===s&&(e=i[t.charCodeAt(u)]<<2|i[t.charCodeAt(u+1)]>>4,a[l++]=255&e);1===s&&(e=i[t.charCodeAt(u)]<<10|i[t.charCodeAt(u+1)]<<4|i[t.charCodeAt(u+2)]>>2,a[l++]=e>>8&255,a[l++]=255&e);return a},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(u(t,s,s+16383>a?a:s+16383));1===i?(e=t[n-1],o.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],o.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function h(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function u(t,e,n){for(var r,i=[],o=e;o<n;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(h(r));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,i){var o,s,a=8*i-r-1,l=(1<<a)-1,c=l>>1,h=-7,u=n?i-1:0,d=n?-1:1,f=t[e+u];for(u+=d,o=f&(1<<-h)-1,f>>=-h,h+=a;h>0;o=256*o+t[e+u],u+=d,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+t[e+u],u+=d,h-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),o-=c}return(f?-1:1)*s*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var s,a,l,c=8*o-i-1,h=(1<<c)-1,u=h>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(s++,l/=2),s+u>=h?(a=0,s=h):s+u>=1?(a=(e*l-1)*Math.pow(2,i),s+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,i),s=0));i>=8;t[n+f]=255&a,f+=p,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;t[n+f]=255&s,f+=p,s/=256,c-=8);t[n+f-p]|=128*g}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const o=n(1),s=i(n(0));e.ConsoleFile=class extends s.BasicFile{constructor(){super(),this.created=new Date,this.lastModified=new Date,this.extra={}}get id(){return"console"}get name(){return"console"}get icon(){return null}get url(){return null}get mimeType(){return"text/plain"}get size(){return 0}read(t){return r(this,void 0,void 0,function*(){return new ArrayBuffer(0)})}write(t){return r(this,void 0,void 0,function*(){return console.log(o.parseTextArrayBuffer(t)),t})}delete(){return r(this,void 0,void 0,function*(){throw new Error("can't delete console")})}rename(t){return r(this,void 0,void 0,function*(){throw new Error("can't rename console")})}}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(0);e.NullFile=class extends i.BasicFile{constructor(){super(),this.created=new Date,this.lastModified=new Date,this.extra={}}get id(){return"null"}get name(){return"null"}get icon(){return null}get url(){return null}get mimeType(){return"text/plain"}get size(){return 0}read(t){return r(this,void 0,void 0,function*(){return new ArrayBuffer(0)})}write(t){return r(this,void 0,void 0,function*(){return t})}delete(){return r(this,void 0,void 0,function*(){})}rename(t){return r(this,void 0,void 0,function*(){throw new Error("can't rename null file")})}}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n(0)),s=n(1);class a extends o.BasicFile{constructor(t){super(),this.created=new Date,this.extra={},this.lastModified=new Date,this.element=t}get id(){return`${this.name}-${this.element.id}`}get icon(){return null}get url(){return null}delete(){return r(this,void 0,void 0,function*(){throw new Error("can't delete element file")})}rename(t){return r(this,void 0,void 0,function*(){throw new Error("can't rename element file")})}}e.AbstractElementFile=a;class l extends a{constructor(t){super(t),this.readBuffer=[],this.element.addEventListener(this.eventName,t=>{for(console.log("EVENT",t);this.readBuffer.length>0;){let e=this.readBuffer.shift();void 0!==e&&e(t)}this.lastModified=new Date},!1)}get size(){return 0}get eventName(){return this.EVENT_NAME}getEventData(t){throw new Error("getEventData not implemented.")}read(t){return new Promise((t,e)=>{this.readBuffer.push(e=>{t(this.getEventData(e))})})}}class c extends l{constructor(){super(...arguments),this.EVENT_NAME="keydown"}get name(){return"keyboard"}get mimeType(){return"text/plain"}getEventData(t){return s.stringToArrayBuffer(t.char)}write(t){return r(this,void 0,void 0,function*(){let e=s.parseTextArrayBuffer(t);for(let t of e){let e=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,key:t,char:t,shiftKey:!1}),n=new KeyboardEvent("keyup",{bubbles:!0,cancelable:!0,key:t,char:t,shiftKey:!1});this.element.dispatchEvent(e),this.element.dispatchEvent(n)}return t})}}class h extends l{constructor(){super(...arguments),this.EVENT_NAME="click"}get name(){return"mouse"}get mimeType(){return"application/json"}getEventData(t){let e={clientX:t.clientX||null,clientY:t.clientY||null,offsetX:t.offsetX||null,offsetY:t.offsetY||null,pageX:t.pageX||null,pageY:t.pageY||null};return s.stringToArrayBuffer(JSON.stringify(e))}write(t){return r(this,void 0,void 0,function*(){return t})}}class u extends a{constructor(t){super(t)}get name(){return"text"}get size(){return s.stringToArrayBuffer(this.element.innerText).byteLength}get mimeType(){return"text/plain"}get url(){return`data:,${encodeURIComponent(this.element.innerText)},`}read(t){return r(this,void 0,void 0,function*(){return s.stringToArrayBuffer(this.element.innerText)})}write(t){return r(this,void 0,void 0,function*(){return this.element.innerText=s.parseTextArrayBuffer(t),t})}}class d extends a{constructor(t){super(t)}get name(){return"class"}get size(){return s.stringToArrayBuffer(this.element.className).byteLength}get mimeType(){return"text/plain"}get url(){return`data:,${encodeURIComponent(this.element.className)},`}read(t){return r(this,void 0,void 0,function*(){return s.stringToArrayBuffer(this.element.className)})}write(t){return r(this,void 0,void 0,function*(){return this.element.className=s.parseTextArrayBuffer(t),t})}}class f extends o.Directory{constructor(t){super(),this.created=new Date,this.lastModified=new Date,this.extra={},""===t.id&&(t.id=`${Math.random().toString(36).substr(2,9)}`),this.element=t,this.keyboard=new c(t),this.mouse=new h(t),this.text=new u(t),this.class=new d(t)}get id(){return this.element.id}get name(){return`${this.element.tagName.toLowerCase()}-${this.id}`}get size(){return 0}get icon(){return null}addFile(t,e,n){return r(this,void 0,void 0,function*(){throw new Error("can't add file to element")})}addDirectory(t){return r(this,void 0,void 0,function*(){let e=document.createElement(t);return this.element.appendChild(e),new f(e)})}getChildren(){return r(this,void 0,void 0,function*(){let t=[this.keyboard,this.mouse,this.text,this.class];for(let e of this.element.children)e instanceof HTMLElement&&t.push(new f(e));return t})}delete(){return r(this,void 0,void 0,function*(){null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element)})}rename(t){return r(this,void 0,void 0,function*(){throw new Error("can't rename element")})}search(t){return r(this,void 0,void 0,function*(){return[]})}}e.DomElementDevice=f},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const o=n(0),s=n(1),a=i(n(19)),l=n(20),c=n(6),h=n(22),u=n(4),d=n(21),f=n(2);class p extends h.Row{constructor(){super(...arguments),this.file=null}getFile(){return this.file}setFile(t){this.file=t;let e=document.createElement("table-data"),n=document.createElement("table-data"),r=document.createElement("table-data"),i=document.createElement("table-data"),o=document.createElement("table-data"),a=document.createElement("table-data");this.hidden=this.file.name.startsWith("."),e.innerText=t.id,n.innerText=t.name,r.innerText=s.convertBytesToReadable(t.size),i.innerText=new Date(t.lastModified).toLocaleString(),o.innerText=new Date(t.created).toLocaleString(),a.innerText=t.mimeType,this.removeChildren(),this.appendChildren([e,n,r,i,o,a])}}class g extends f.CustomElement{constructor(){super(),this.searchPending=!1,this.messageRemovalDelay=null,this.maxNumMove=30,this.table=document.createElement("selectable-table"),this.history=document.createElement("bread-crumbs"),this.dropdownMenuIcon=g.createIconTemplate(a.dropdownMenuIcon),this.dropdownMenuIcon.classList.add(g.tableIconClass),this.carrotIcon=g.createIconTemplate(a.carrotIcon),this.carrotIcon.classList.add(g.tableIconClass),this.carrotIcon.classList.add("small"),this.searchIcon=g.createIconTemplate(a.searchIcon),this.searchIcon.classList.add(g.tableIconClass),this.folderIcon=g.createIconTemplate(a.folderIcon),this.folderIcon.classList.add(g.tableIconClass),this.documentIcon=g.createIconTemplate(a.documentIcon),this.documentIcon.classList.add(g.tableIconClass),this.contextMenu=document.createElement("base-dialog"),this.contextMenu.className=g.contextMenuClass,this.contextMenu.name="Settings",this.actionsContainer=document.createElement("div"),this.actionsContainer.className=g.actionsContainerClass,this.messagesContainer=document.createElement("div"),this.messagesContainer.className=g.messageContainerClass,this.menusContainer=this.createMenus(),this.searchContainer=this.createSearchElements(),this.tableContainer=document.createElement("div"),this.tableContainer.appendChild(this.table),this.tableContainer.className=g.tableContainerClass,this.actionsContainer.appendChild(this.history),this.actionsContainer.appendChild(this.messagesContainer),this.actionsContainer.appendChild(this.menusContainer),this.actionsContainer.appendChild(this.searchContainer),this.table.oncontextmenu=(t=>{this.showContextMenu(t.pageX,t.pageY)}),this.table.ondrop=(t=>{null!==t.dataTransfer&&this.handleDataTransfer(t.dataTransfer)});let t=document.createElement("file-header");this.table.appendChild(t),this.history.onclick=(t=>{this.path=this.history.path}),this.busy=Promise.resolve(),this.currentDirectory=new d.CachedProxyDirectory(new u.MemoryDirectory(null,"root"))}static get observedAttributes(){return[]}updateAttributes(t){}static createIconTemplate(t){let e=document.createElement("template");return e.innerHTML=t,e.content.firstChild}get rootDirectory(){return this.currentDirectory.root}set rootDirectory(t){console.log("SET ROOT",t,t.getChildren().then(t=>console.log(t))),this.currentDirectory=new d.CachedProxyDirectory(t),this.refreshFiles()}get path(){return this.currentDirectory.path.slice(1).reduce((t,e)=>(t.push(e.name),t),[])}set path(t){console.log("SET PATH",t),this.busy=this.busy.then(()=>this.logAndLoadWrapper(this.currentDirectory.root.getFile(t).then(e=>{if(console.log("NEW DIR",e),!(e instanceof d.CachedProxyDirectory))throw new o.FileNotFoundError("file must be a directory");return this.currentDirectory=e,this.history.path=t,this.currentDirectory.getChildren()}).then(t=>{this.setTableData(t)})))}get css(){return super.css+`\n        :host {\n          --icon-color: #5c6873;\n          --action-icon-color: #5c6873;\n          --icon-size: 22px;\n          --icon-size-small: 12px;\n          --icon-size-large: 32px;\n        }\n\n        .${g.tableIconClass} {\n          display: inline-block;\n          width: var(--icon-size);\n          height: var(--icon-size);\n          vertical-align: middle;\n          margin: 5px;\n          fill: var(--icon-color);\n        }\n\n        .${g.tableIconClass}.small {\n          width: var(--icon-size-small);\n          height: var(--icon-size-small);\n        }\n\n        .${g.tableIconClass}.large {\n          width: var(--icon-size-large);\n          height: var(--icon-size-large);\n        }\n\n        .${g.tableContainerClass} {\n          position: relative;\n          width: 100%;\n          background: var(--table-background-color);\n        }\n\n        .${g.tableContainerClass}.dialog-item {\n          /*If inside dialog, make smaller*/\n          height: 300px;\n        }\n\n        .${g.tableContainerClass} .hover-image {\n          position: absolute;\n          top: calc(2 * var(--table-row-height));\n          max-height: calc(100% - 3 * var(--table-row-height));\n          z-index: 99999;\n          background-color: white;\n          border: 1px solid black;\n          box-shadow: var(--browser-shadow);\n        }\n    `}render(t){super.render(t),t.appendChild(this.history),t.appendChild(this.actionsContainer),t.appendChild(this.tableContainer)}loadingWrapper(t){return r(this,void 0,void 0,function*(){this.classList.add(g.activeAjaxClass);try{return yield t}finally{this.classList.remove(g.activeAjaxClass)}})}errorLoggingWrapper(t){return r(this,void 0,void 0,function*(){try{return yield t}catch(t){this.addMessage(t,!0)}})}logAndLoadWrapper(t){return this.loadingWrapper(this.errorLoggingWrapper(t))}createSearchElements(){let t=document.createElement("input");t.className=g.searchInputClass,t.placeholder="Search",t.oninput=(()=>{this.searchPending||(this.searchPending=!0,setTimeout(()=>{this.search(t.value),this.searchPending=!1},500))}),t.onkeyup=(e=>{this.searchPending||"Enter"!==e.key||this.search(t.value)});let e=document.createElement("div");return e.className=g.searchContainerClass,e.appendChild(this.searchIcon),e.appendChild(t),e}createMenus(){let t=document.createElement("div");t.className=g.menuContainerClass;let e=document.createElement("div");return e.className=g.dropdownMenuButtonClass,e.appendChild(this.dropdownMenuIcon.cloneNode(!0)),e.appendChild(this.carrotIcon.cloneNode(!0)),e.onclick=(t=>{t.stopPropagation();let n=e.getBoundingClientRect(),r=document.documentElement.scrollLeft,i=document.documentElement.scrollTop;this.showContextMenu(n.left+r,n.bottom+i)}),t.appendChild(e),t}handleDataTransfer(t){return r(this,void 0,void 0,function*(){this.clearMessages();let e=[];for(let n of t.files)e.push(s.fileToArrayBuffer(n).then(t=>this.currentDirectory.addFile(t,n.name,n.type)));let n=t.getData("text/uri-list");if(n){let t=n.split("\n");if(t.length>this.maxNumMove)alert(`Cannot move more than ${this.maxNumMove} items.`);else for(let n=0;n<t.length;n++){let r=t[n];if(!r.startsWith("#")){let t=r.split("/");t.length>0&&t[t.length-1].length<255?e.push(this.currentDirectory.addFile(r,t[t.length-1])):e.push(this.currentDirectory.addFile(r,"unknown"))}}}this.logAndLoadWrapper(Promise.all(e).then(()=>{}));let i=t.getData(h.Table.dataTransferType);if(i){let t=JSON.parse(i),e=[],n=[];for(let n of t)e.push(n.name);if(n.length>this.maxNumMove)alert(`Cannot move more than ${this.maxNumMove} items.`);else if(n.length>0){let n=document.createElement("confirm-dialog");n.name="Confirm Move",n.onClose=(()=>{n.remove()});let i=document.createElement("div");i.innerText=`Are you sure you want to move ${e.join(", ")}?`,n.onConfirmed=(()=>{let e=[];for(let n of t){let t=t=>r(this,void 0,void 0,function*(){let e=yield this.currentDirectory.getFile(t.path);return yield this.currentDirectory.move(e)});e.push(t(n))}this.logAndLoadWrapper(Promise.all(e).then(()=>{})),this.contextMenu.visible=!1}),n.appendChild(i),n.visible=!0}}})}search(t){return r(this,void 0,void 0,function*(){this.clearMessages(),t?yield this.loadingWrapper(this.currentDirectory.search(t).then(e=>{this.setTableData(e);let n=[this.history.baseName].concat(this.path).join("/");this.addMessage(`${e.length} search results for "${t}" in ${n}.`)})):yield this.loadingWrapper(this.currentDirectory.getChildren().then(t=>{this.setTableData(t)}))})}fileObjectToTableRow(t){let e=document.createElement("file-row");return e.setFile(t),t.directory&&e.addDragoverAction(()=>{this.path=this.path.concat([t.name])}),e}setTableData(t){let e=[];for(let n of t){let t=this.fileObjectToTableRow(n);t.hidden=n.name.startsWith("."),n instanceof o.Directory?(t.addDragoverAction(()=>{this.path=this.path.concat([n.name])}),t.ondblclick=(t=>{this.path=this.path.concat([n.name])})):t.ondblclick=(t=>{if(null!==n.url)if(n.url.startsWith("data")){let t=document.createElement("a");t.href=n.url||"",t.setAttribute("download",n.name),t.click()}else window.open(n.url)}),e.push(t)}this.table.rows=e}showContextMenu(t,e){this.contextMenu.removeChildren();let n=[];for(let t of this.table.selectedRows)t instanceof p&&n.push(t);this.contextMenu.appendChildren(this.getMenuItems(n)),this.contextMenu.position={x:t,y:e},this.contextMenu.velocity={x:0,y:0},this.contextMenu.visible=!0}getMenuItems(t){let e=[];if(t.length>0){if(1===t.length){const n=t[0],i=n.getFile();if(null!==i){let t=document.createElement("div");if(t.innerText="Open",t.onclick=(()=>{i.directory?this.path=this.path.concat([i.name]):window.open(i.url||""),this.contextMenu.visible=!1}),e.push(t),i.url){let t=document.createElement("div");t.innerText="Copy Url",t.onclick=(()=>{let e=document.createElement("textarea");t.appendChild(e),e.innerText=i.url||"",e.select(),document.execCommand("copy"),t.removeChild(e)}),e.push(t)}let o=document.createElement("div");if(o.innerText="Rename",o.onclick=(()=>{this.logAndLoadWrapper((()=>r(this,void 0,void 0,function*(){let t=prompt("New Name");null!==t&&(this.contextMenu.visible=!1,yield i.rename(t),yield this.refreshFiles())}))())}),e.push(o),"application/javascript"===i.mimeType){let t=document.createElement("div");t.innerText="Run",t.onclick=(()=>{this.errorLoggingWrapper((()=>r(this,void 0,void 0,function*(){yield this.currentDirectory.execPath(n.path)}))())}),e.push(t)}}}let n=document.createElement("div");if(n.innerText="Delete",n.onclick=(e=>{e.preventDefault(),e.stopPropagation();let n=document.createElement("confirm-dialog");this.contextMenu.appendChild(n),n.onClose=(()=>{n.remove()});let i=document.createElement("div"),o=[];for(let e of t){let t=e.getFile();null!==t&&o.push(t.name)}i.innerText=`Are you sure you want to remove ${o.join(", ")}?`;let s=[];n.onConfirmed=(()=>{this.logAndLoadWrapper((()=>r(this,void 0,void 0,function*(){for(let e of t){let t=e.getFile();null!==t&&s.push(t.delete())}this.contextMenu.visible=!1,yield Promise.all(s),yield this.currentDirectory.clearCache()}))())}),n.appendChild(i),n.visible=!0}),e.push(n),t.length<=30){let n=document.createElement("div");n.innerText="Move",n.onclick=(e=>{e.preventDefault(),e.stopPropagation();let n=document.createElement("file-browser");n.rootDirectory=this.rootDirectory;let i=document.createElement("confirm-dialog");n.table.selectMultiple=!1,i.name="Move Files",i.classList.add(this.fileBrowserDialogClass),i.confirmationText="Select",i.onConfirmed=(()=>{this.logAndLoadWrapper((()=>r(this,void 0,void 0,function*(){let e=n.currentDirectory.path;if(1===n.table.selectedRows.length){let t=n.table.selectedData.values().next().value.name;e.push(t)}let r=[];for(let i of t){let t=yield n.currentDirectory.getFile(i.path);r.push(n.currentDirectory.move(e,t).then(()=>{}))}yield Promise.all(r),yield this.refreshFiles()}))())}),this.contextMenu.appendChild(i),i.addEventListener(c.Dialog.EVENT_CLOSED,()=>{this.contextMenu.removeChild(i)}),i.visible=!0}),e.push(n)}}let n=document.createElement("div");n.innerText="Add File",n.onclick=(t=>{t.preventDefault(),t.stopPropagation();let e=document.createElement("confirm-dialog");e.name="Add File",e.confirmationText="Add";let n=document.createElement("div"),r=document.createElement("span");r.innerText="File";let i=document.createElement("input");i.type="file",n.appendChild(r),n.appendChild(i),e.onConfirmed=(()=>{let t=[];if(null!==i.files)for(let e of i.files)t.push(s.fileToArrayBuffer(e).then(t=>this.currentDirectory.addFile(t,e.name,e.type)));this.contextMenu.visible=!1,this.logAndLoadWrapper(Promise.all(t).then(()=>{}))}),e.appendChild(n),this.contextMenu.appendChild(e),e.visible=!0}),e.push(n);let i=document.createElement("div");i.innerText="Add Directory",i.onclick=(()=>{let t=prompt("Directory Name");null!==t&&this.logAndLoadWrapper(this.currentDirectory.addDirectory(t).then(()=>{})),this.contextMenu.visible=!1}),e.push(i);let o=document.createElement("div"),a=document.createElement("span"),l=document.createElement("input");l.type="checkbox",l.checked=this.table.showHidden,a.innerText="Show Hidden",l.onchange=(()=>{this.table.showHidden=l.checked}),o.appendChild(a),o.appendChild(l),e.push(o);let h=document.createElement("div");return h.innerText="Visible Columns",h.onclick=(t=>{t.preventDefault(),t.stopPropagation(),this.table.visibleColumnsDialog.visible=!0}),e.push(h),e}addMessage(t,e){console.log(t);let n=document.createElement("user-message");(t instanceof Error||e)&&n.setAttribute("error",""),n.innerText=t.toString(),this.messagesContainer.appendChild(n)}clearMessages(){for(;this.messagesContainer.firstChild;)this.messagesContainer.removeChild(this.messagesContainer.firstChild)}refreshFiles(){return r(this,void 0,void 0,function*(){this.currentDirectory.clearCache();let t=yield this.currentDirectory.getChildren();console.log("CHILDREN",t,this.currentDirectory),yield this.setTableData(t)})}}g.actionsContainerClass="file-actions-container",g.tableContainerClass="file-browser-table-container",g.tableIconClass="icon",g.activeAjaxClass="ajax-active",g.searchInputClass="file-search-input",g.messageContainerClass="file-message-container",g.menuContainerClass="file-menu-container",g.searchContainerClass="file-search-container",g.stateManagerContainerClass="file-breadcrumbs-container",g.contextMenuClass="file-browser-context-menu",g.dropdownMenuButtonClass="dropdown-menu button",g.fileBrowserDialogClass="file-browser-dialog",e.FileBrowser=g;e.DialogBrowser=class extends g{constructor(t,e,n){n=n||new c.ConfirmDialog,super(t,e),this._dialog=n,this.contextMenu.parent=this._dialog,this.table.visibleColumnsDialog.parent=this._dialog,this._dialog.items=[this.element]}get dialog(){return this._dialog}},e.ConfigFileMixin=(t=>(class extends t{constructor(...t){super(...t),this.logAndLoadWrapper(this.getConfig().then(t=>{try{this.config=t}catch(t){console.log(`Error setting browser config: ${t}`)}}))}static get localConfigPath(){return[".config","browser"]}static get sharedConfigPath(){return["Files",".config","browser"]}static get configPaths(){return[this.sharedConfigPath,this.localConfigPath]}set config(t){let e=t.visibleColumns;if(e){let t=e.split(",");for(let e of this.table.columns)e.visible=t.includes(e.name)}let n=t.defaultSortColumn;if(n){let t=!1;n.startsWith("-")&&(t=!0,n=n.slice(1));for(let e of this.table.columns)if(e.name===n){let n;n=e.sortCompare&&t?(...t)=>-e.sortCompare(...t):e.sortCompare,this.table.defaultSortFunc=n,this.setTableData(Object.values(this.currentDirectory.data))}}}setupTable(){if(super.setupTable(),this.table)for(let t of this.table.columns){let e=t.onVisibilityChange;t.onVisibilityChange=(t=>{e(t);let n=[];for(let t of this.table.columns)t.visible&&n.push(t.name);this.addLocalConfig({visibleColumns:n.join(",")}).then().catch(t=>{console.log(`Error adding config: ${t}`)})})}}addLocalConfigFile(){return r(this,void 0,void 0,function*(){let t=this.constructor.localConfigPath.slice(),e=t.pop(),n=[];for(;t.length>0;){n.push(t.shift());try{yield this.currentDirectory.getFile(n)}catch(t){if(!(t instanceof o.FileNotFoundError))throw t;yield this.currentDirectory.addDirectory(n.slice(0,n.length-1),n[n.length-1])}}yield this.currentDirectory.addFile(n,new File([""],e,{type:"text/plain"}),e)})}addLocalConfig(t){return r(this,void 0,void 0,function*(){let e;try{let n=yield(yield this.currentDirectory.getFile(this.constructor.localConfigPath)).read();e=l.updateConfigFile(t,n)}catch(t){t instanceof o.FileNotFoundError&&(yield this.currentDirectory.waitOn(this.addLocalConfigFile.bind(this))()),e=l.updateConfigFile({})}try{yield this.currentDirectory.write(this.constructor.localConfigPath,e)}catch(t){t instanceof o.FileNotFoundError&&(yield this.currentDirectory.write(this.constructor.localConfigPath,e))}})}getConfig(){return r(this,void 0,void 0,function*(){let t={},e=this.constructor.configPaths.slice();for(;e.length>0;){let n,r=e.shift();try{let t=yield(yield this.currentDirectory.getFile(r)).read();n=l.parseConfigFile(t)}catch(t){console.log(`Could not get config file at /${r.join("/")}: ${t}`),n={}}Object.assign(t,n)}return t})}})),customElements.define("file-browser",g),customElements.define("file-row",p),customElements.define("file-header",class extends h.Header{constructor(){super()}refresh(){super.refresh();let t=document.createElement("table-data"),e=document.createElement("table-data"),n=document.createElement("table-data"),r=document.createElement("table-data"),i=document.createElement("table-data"),o=document.createElement("table-data");t.innerText="ID",e.innerText="Name",n.innerText="Size",r.innerText="Last Modified",i.innerText="Created",o.innerText="Type",this.appendChild(t),this.appendChild(e),this.appendChild(n),this.appendChild(r),this.appendChild(i),this.appendChild(o)}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.dropdownMenuIcon='<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 440 440">  <path d="M170 423 c0 -38 -15 -46 -49 -29 -31 17 -32 16 -62 -13 -29 -30 -30\n-31 -13 -62 17 -34 9 -49 -28 -49 -26 0 -26 -100 0 -100 37 0 45 -15 28 -49\n-17 -31 -16 -32 13 -62 30 -29 31 -30 62 -13 34 17 49 9 49 -28 0 -26 100 -26\n100 0 0 37 15 45 49 28 31 -17 32 -16 62 13 29 30 30 31 13 62 -17 34 -9 49\n29 49 25 0 25 100 0 100 -38 0 -46 15 -29 49 17 31 16 32 -13 62 -30 29 -31\n30 -62 13 -34 -17 -49 -9 -49 29 0 25 -100 25 -100 0z m105 -148 c50 -49 15\n-135 -55 -135 -41 0 -80 39 -80 80 0 19 9 40 25 55 15 16 36 25 55 25 19 0 40\n-9 55 -25z"/>  <path d="M182 258 c-15 -15 -15 -61 0 -76 15 -15 61 -15 76 0 15 15 15 61 0\n76 -7 7 -24 12 -38 12 -14 0 -31 -5 -38 -12z"/></svg>',e.carrotIcon='<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="24pt" height="16pt" viewBox="0 0 24 16">  <path d="M 12,16 0,7 5.25,0.25 12,5.5 18,0.25 24,7 Z"/></svg>',e.searchIcon='<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="220" height="220" viewBox="0 0 440 440">  <path d="m 180,310 -40,56 C 116,396 86,422 74,426 30,438 2,410 14,366 18,354 44,324 74,300 l 56,-40 C 81.263674,188.193 104,100 160,50 220,-3 326,-4 380,60 c 53,62 59,175 1,229 C 320,346 225,354 180,310 Z M 340,100 C 247,-3 100,140 190,250 282,347 435,206 340,100 Z"/></svg>',e.folderIcon='<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 440 440">  <path d="M0 220 l0 190 220 0 220 0 0 -166 0 -165 -124 0 -125 0 -16 -28 c-15 -26 -20 -27 -96 -27 l-79 0 0 -190z"/></svg>',e.documentIcon='<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="220" height="220" viewBox="0 0 440 440">  <path d="M 390,220 V 440 H 215 40 V 278 116 L 97,58 154,0 H 272 390 Z M 124,130 H 80 V 265 400 H 215 350 V 220 41 H 170 v 90 0 z"/></svg>'},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(1);function o(t){let e={};try{let n=i.parseTextArrayBuffer(t).split("\n");for(let t of n){let n=t.split("=");2===n.length&&(e[n[0].trim()]=n[1].trim())}}catch(t){console.log(`Error parsing config file: ${t}`)}return e}e.parseConfigFile=o,e.updateConfigFile=function(t,e){return r(this,void 0,void 0,function*(){let n;n=e?o(e):{},Object.assign(n,t);let r="";for(let t in n)r+=`${t}=${n[t]}\n`;return i.stringToArrayBuffer(r)})}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n(0));e.ProxyFile=class extends o.BasicFile{constructor(t){super(),this.concreteFile=t}get id(){return this.concreteFile.id}get name(){return this.concreteFile.name}get directory(){return this.concreteFile.directory}get url(){return this.concreteFile.url}get icon(){return this.concreteFile.icon}get size(){return this.concreteFile.size}get mimeType(){return this.concreteFile.mimeType}get lastModified(){return this.concreteFile.lastModified}get created(){return this.concreteFile.created}get extra(){return this.concreteFile.extra}read(t){return this.concreteFile.read(t)}write(t){return this.concreteFile.write(t)}rename(t){return this.concreteFile.rename(t)}delete(){return this.concreteFile.delete()}};class s extends o.Directory{constructor(t){super(),this.concreteDirectory=t}get id(){return this.concreteDirectory.id}get name(){return this.concreteDirectory.name}get directory(){return this.concreteDirectory.directory}get url(){return this.concreteDirectory.url}get icon(){return this.concreteDirectory.icon}get lastModified(){return this.concreteDirectory.lastModified}get created(){return this.concreteDirectory.created}get extra(){return this.concreteDirectory.extra}rename(t){return this.concreteDirectory.rename(t)}delete(){return this.concreteDirectory.delete()}search(t){return this.concreteDirectory.search(t)}addFile(t,e,n){return this.concreteDirectory.addFile(t,e,n)}addDirectory(t){return this.concreteDirectory.addDirectory(t)}getChildren(){return this.concreteDirectory.getChildren()}}e.ProxyDirectory=s;class a extends s{constructor(t,e){super(t),this.cachedChildren=null,this.parent=e||null}get root(){return null===this.parent?this:this.parent.root}get path(){return null===this.parent?[this]:this.parent.path.concat([this])}getChildren(){const t=Object.create(null,{getChildren:{get:()=>super.getChildren}});return r(this,void 0,void 0,function*(){if(null===this.cachedChildren){this.cachedChildren=[];for(let e of yield t.getChildren.call(this))e instanceof o.Directory&&(e=new a(e,this)),this.cachedChildren.push(e)}return this.cachedChildren.slice()})}clearCache(){this.cachedChildren=null}}e.CachedProxyDirectory=a},function(t,e,n){"use strict";n.r(e);var r=n(6),i=n(2),o=n(3);function s(t){return class extends t{constructor(...t){super(...t),this.dragOverActions=[],this.dragOverDelay=2e3,this.timeOuts=[],this.addEventListener("dragover",this.handleDragOver.bind(this)),this.addEventListener("dragenter",this.handleDragEnter.bind(this)),this.addEventListener("dragleave",this.handleDragLeave.bind(this)),this.addEventListener("drop",this.handleDrop.bind(this))}static get dragOverClass(){return"dragover"}static get pendingActionClass(){return"pending-action"}get isOver(){return this.classList.contains(this.constructor.dragOverClass)}addDragoverAction(t){this.dragOverActions.push(t)}handleDragOver(t){t.preventDefault()}handleDragEnter(t){t.preventDefault(),this.classList.add(this.constructor.dragOverClass),this.setTimeouts()}handleDragLeave(t){t.preventDefault(),this.classList.remove(this.constructor.dragOverClass),this.clearTimeOuts()}handleDrop(t){t.preventDefault(),this.classList.remove(this.constructor.dragOverClass),this.clearTimeOuts()}setTimeouts(){if(this.dragOverActions.length>0){for(let t of this.dragOverActions){let e=window.setTimeout(()=>{t()},this.dragOverDelay);this.timeOuts.push(e)}this.classList.add(this.constructor.pendingActionClass)}}clearTimeOuts(){this.classList.remove(this.constructor.pendingActionClass);for(let t of this.timeOuts)window.clearTimeout(t);this.timeOuts=[]}}}n.d(e,"Header",function(){return h}),n.d(e,"Row",function(){return u}),n.d(e,"Data",function(){return d}),n.d(e,"Table",function(){return f});customElements.define("table-body",class extends o.b{get template(){return"\n      <slot></slot>\n    "}get parentHeightDifference(){return null===this.parentElement?0:this.parentElement.getBoundingClientRect().height-this.getBoundingClientRect().height}get position(){return super.position}set position(t){t.x=0,t.y=Math.min(0,Math.max(this.parentHeightDifference,t.y||0)),super.position=t}});class a extends i.CustomElement{constructor(){super(),this.view=document.createElement("div"),this.pane=document.createElement("table-body");let t=document.createElement("slot");this.pane.appendChild(t),this.view.appendChild(this.pane)}updateAttributes(t){}render(t){super.render(t),this.view.style.position="relative",this.view.style.overflowY="hidden",this.view.style.height="inherit",this.view.style.width="100%",this.pane.style.width="100%",t.appendChild(this.view)}}class l extends i.CustomElement{get table(){let t=this.parentElement;for(;t;){if(t instanceof f)return t;t=t.parentElement}return null}updateAttributes(t){}}class c extends l{constructor(){super(),this.hiddenClass="hidden"}get css(){return"\n        :host {\n            --selected-item-color: #5d91e5;\n            --focus-item-color: #c0d5e8;\n\n            display: flex;\n            width: 100%;\n            height: var(--table-row-height, 30px);\n            line-height: var(--table-row-height, 30px);\n        }\n     "}get template(){return"\n      <slot></slot>\n    "}get hidden(){return this.classList.contains(this.hiddenClass)}set hidden(t){t?this.classList.add(this.hiddenClass):this.classList.remove(this.hiddenClass)}get allColumns(){return Array.from(this.children).filter(t=>t instanceof d)}getColumn(t){return this.allColumns[t]||null}}class h extends c{constructor(){super(),this.onclick=(t=>{let e=t.target;if(e instanceof d){let t=this.table,n=e.column;null!==t&&null!==n&&t.sortColumn(n)}})}get css(){return super.css+"\n        :host {\n            --table-header-text-color: white;\n            --table-header-color: #5c6873;\n            \n            color: var(--table-header-text-color);\n            background: var(--table-header-color);\n            text-transform: uppercase;\n        }\n        \n        :host > * {\n          cursor: pointer;\n        }\n        \n        a {\n            text-decoration: none;\n            color: var(--table-header-text-color);\n            font-weight: bold;\n        }\n     "}connectedCallback(){super.connectedCallback(),this.setAttribute("slot",f.HEADER_SLOT_NAME)}}class u extends(function(t){return class extends t{constructor(...t){super(...t),this.addEventListener("dragstart",this.handleDragStart.bind(this)),this.addEventListener("dragend",this.handleDragEnd.bind(this))}static get draggingClass(){return"dragging"}connectedCallback(){super.connectedCallback(),this.draggable=!0}handleDragStart(t){this.classList.add(this.constructor.draggingClass)}handleDragEnd(t){this.classList.remove(this.constructor.draggingClass)}}}(s(c))){constructor(){super(),this.selected=!1,this.hidden=!1,this.onclick=(t=>{let e=this.table;if(null!==e){let n,r;t.shiftKey?(n=!0,r=!0):t.ctrlKey||t.metaKey?(n=!1,r=!0):(n=!1,r=!1),e.toggleRowSelection(this,r,n)}})}get css(){return super.css+`\n        :host(:hover) {\n            background: var(--focus-item-color);\n            cursor: pointer;\n        }\n        \n        :host(.${u.SELECTED_CLASS}){\n          background-color: var(--selected-item-color);\n          color: #fff;\n        }\n        \n        :host(.dragover) {\n            background: var(--focus-item-color);\n        }\n        \n        a.button {\n          -webkit-appearance: button;\n          -moz-appearance: button;\n          appearance: button;\n        \n          text-decoration: none;\n          color: initial;\n        }\n    `}get selected(){return this.classList.contains(u.SELECTED_CLASS)}get data(){let t=[];for(let e of this.allColumns)t.push(e.data);return t}set selected(t){t?(this.classList.add(u.SELECTED_CLASS),this.dispatchEvent(new Event("selected"))):(this.classList.remove(u.SELECTED_CLASS),this.dispatchEvent(new Event("deselected")))}toggleSelected(){this.selected=!this.selected}handleDragStart(t){super.handleDragStart(t),t.dataTransfer&&(t.dataTransfer.setData(u.DATA_TRANSFER_TYPE,JSON.stringify(this.data)),t.dataTransfer.dropEffect="move")}}u.DATA_TRANSFER_TYPE="text/table-rows",u.SELECTED_CLASS="selected";class d extends l{constructor(){super(),this.ascendingSortClass="asc",this.descendingSortClass="des"}static get observedAttributes(){return["width"]}get css(){return`\n        :host {\n            flex: 1;\n            padding: 0;\n            text-align: start;\n            font-size: calc(4px + .75vw);\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n        \n        :host::after {\n            float: right;\n            margin-right: 10px;\n        }\n\n        :host(.${this.ascendingSortClass})::after {\n           content: "\\25BC";\n        }\n\n        :host(.${this.descendingSortClass})::after {\n            content: "\\25B2";\n        }\n\n    `}get template(){return"\n      <slot></slot>\n    "}get data(){return this.innerText}set data(t){this.innerText=t.toString()}get width(){let t=this.style.flex;return null===t?null:Number.parseInt(t)}set width(t){this.style.flex=null===t?null:t.toString()}get column(){let t=this.parentElement;return t instanceof c?t.allColumns.indexOf(this):null}get sortOrder(){return this.classList.contains(this.ascendingSortClass)?1:this.classList.contains(this.descendingSortClass)?-1:0}updateAttributes(t){let e=null;null!==t.width&&(e=Number.parseInt(t.width)),this.width=e}compare(t){return this.data.localeCompare(t.data)}toggleSortOrder(){let t=this.ascendingSortClass;this.classList.contains(this.ascendingSortClass)?t=this.descendingSortClass:this.classList.contains(this.descendingSortClass)&&(t=null),this.classList.remove(this.ascendingSortClass,this.descendingSortClass),null!==t&&this.classList.add(t)}}class f extends(s(a)){constructor(){super(),this.headerContainerClass="header",this.showHiddenClass="show-hidden",this.sortStack=[],this._selectMultiple=!1,this.columnsDialog=new r.Dialog,this.columnsDialog.name="Columns",this.onclick=(t=>{let e=t.target;if(e instanceof u&&!this.selectMultiple)for(let t of this.selectedRows)t!==e&&(t.selected=!1)})}static get observedAttributes(){return["select-multiple"]}get template(){return null}get css(){return`      \n        :host {\n            --table-row-height: 30px;\n            --table-background-color: white;\n          \n            position: relative;\n            padding: 0;\n            width: 100%;\n            height: 400px;\n            background-color: var(--table-background-color);\n            border-spacing: 0;\n            box-shadow: none;\n            color: var(--body-text-color);\n        }\n        \n        a {\n            text-decoration: none;\n            color: var(--selected-item-color);\n            font-weight: bold;\n        }\n        \n        .${this.headerContainerClass} {\n            width: 100%;\n        }\n     `}get selectedData(){let t=new Set;for(let e of this.selectedRows)t.add(e.data);return t}get selectedRows(){return Array.from(this.querySelectorAll(`.${u.SELECTED_CLASS}`))}set selectedRows(t){let e=new Set(this.selectedRows),n=new Set(t),r=[...n].filter(t=>!e.has(t)),i=[...e].filter(t=>!n.has(t));for(let t of i)t.selected=!1;for(let t of r)t.selected=!0;let o=new Event(f.EVENT_SELECTION_CHANGED);this.dispatchEvent(o)}get rows(){return this.flatChildren(u)}set rows(t){this.removeChildren(u),this.appendChildren(t)}get showHidden(){return this.classList.contains(this.showHiddenClass)}get visibleColumnsDialog(){return this.columnsDialog}get selectMultiple(){return this._selectMultiple||!1}set selectMultiple(t){this._selectMultiple=t;for(let t of this.flatChildren(u))t.selected=!1}set showHidden(t){t?this.classList.add(this.showHiddenClass):this.classList.remove(this.showHiddenClass)}get mainHeader(){return this.querySelector("table-header")}updateAttributes(t){let e=t["select-multiple"];this.selectMultiple=null!==e}render(t){let e=document.createElement("div");e.className=this.headerContainerClass;let n=document.createElement("slot");n.name=f.HEADER_SLOT_NAME,e.appendChild(n),t.appendChild(e),super.render(t)}sortColumn(t){let e=this.mainHeader;if(e){let n=e.getColumn(t);if(n){if(n.toggleSortOrder(),0===n.sortOrder){let t=this.sortStack.indexOf(n);t&&this.sortStack.splice(t,1)}else this.sortStack.push(n);this.sort()}}}sort(){let t=document.createDocumentFragment(),e=this.rows,n=[];for(let t of this.sortStack){let e=t.sortOrder,r=t.column;0!==e&&null!==r&&n.unshift({columnNumber:r,sortOrder:e})}e=e.sort((t,e)=>{for(let r of n){let n=t.getColumn(r.columnNumber),i=e.getColumn(r.columnNumber);if(null===n||null===i)return 0;n.compare(i);let o=r.sortOrder*n.compare(i);if(0!==o)return o}return 0});for(let n of e)t.appendChild(n);this.appendChild(t)}toggleRowSelection(t,e,n){this.selectMultiple||(e=!1,n=!1);let r,i=new Set(this.selectedRows);if(r=e?new Set(i):new Set,!n&&i.has(t)?r.delete(t):null!==t&&r.add(t),e&&n&&i.size>0){let e=this.rows,n=e.indexOf(t),o=e.indexOf(t);for(let t of i){let r=e.indexOf(t);Math.abs(r-o)<Math.abs(n-o)&&(n=r)}let s=Math.min(n,o)+1,a=Math.max(n,o),l=e.slice(s,a);for(let t of l)!this.showHidden&&t.hidden||r.add(t)}this.selectedRows=Array.from(r)}}f.HEADER_SLOT_NAME="header",f.EVENT_SELECTION_CHANGED="selectionchanged",customElements.define("table-header",h),customElements.define("table-row",u),customElements.define("table-data",d),customElements.define("selectable-table",f)},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const o=n(21),s=i(n(0));class a extends o.ProxyDirectory{constructor(t,e){super(t),this.mounts=e||{}}getChildren(){const t=Object.create(null,{getChildren:{get:()=>super.getChildren}});return r(this,void 0,void 0,function*(){let e=yield t.getChildren.call(this),n=[];for(let t of e){let e=this.mounts[t.id];void 0!==e?n.push(new a(e)):t instanceof s.Directory?n.push(new a(t,this.mounts)):n.push(t)}return n})}addDirectory(t){const e=Object.create(null,{addDirectory:{get:()=>super.addDirectory}});return r(this,void 0,void 0,function*(){let n=yield e.addDirectory.call(this,t);return new a(n,this.mounts)})}mount(t){this.mounts[this.id]=t}}e.VirtualDirectory=a}]);
//# sourceMappingURL=bundle.1.3.2.js.map